{"ast":null,"code":"import _toConsumableArray from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/denis/Desktop/projects/movies-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import Movie from\"./Movie\";import{wait,generateArrays,getMovieSize,generateList}from\"../../functions/functions\";import MoviePopup from\"./parts/movie-preview/MoviePopup\";import{apiGetRequest}from\"../../api/api\";import InfiniteScroll from\"react-infinite-scroll-component\";import Navbar from\"../navbar/Navbar\";import SmallLoader from\"../parts/SmallLoader\";function isHidden(el){return el.offsetParent===null;}var MoviesList=/*#__PURE__*/function(_Component){_inherits(MoviesList,_Component);function MoviesList(){var _this;_classCallCheck(this,MoviesList);_this=_possibleConstructorReturn(this,_getPrototypeOf(MoviesList).call(this));_this.updateSize=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$state,movies,pending_movies,size,width,obj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$state=_this.state,movies=_this$state.movies,pending_movies=_this$state.pending_movies,size=_this$state.size;width=window.innerWidth;_context.next=4;return getMovieSize(movies,pending_movies,width,size);case 4:obj=_context.sent;if(obj.movies){_this.setState({movies:obj.movies,pending_movies:obj.pending,size:obj.size});}case 6:case\"end\":return _context.stop();}}},_callee);}));_this.handleMovieSelect=function(row_id,movie){_this.setState({selected:row_id,selected_movie:movie.id,show_popup:true});_this.scrollToElement();};_this.updateState=function(name,value){_this.setState(_defineProperty({},name,value));};_this.scrollToElement=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var size;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:size=_this.state.size;wait(size===2?100:400).then(function(){var element=document.querySelector(\"#selected__row__offset\");if(element){element.scrollIntoView({behavior:\"auto\",block:\"start\",inline:\"nearest\"});}});case 2:case\"end\":return _context2.stop();}}},_callee2);}));_this.selectCategory=function(category){_this.setState({api:category.api,page:1,movies:[],pending_movies:[],selected_movie:'',show_popup:false,selected:''},function(){_this.loadElements();});};_this.closePreview=function(){_this.setState({selected:\"\",selected_movie:\"\",show_popup:\"\"});};_this.loadElements=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _this$state2,size,page,api;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$state2=_this.state,size=_this$state2.size,page=_this$state2.page,api=_this$state2.api;_context4.prev=1;_context4.next=4;return apiGetRequest(api,page).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(res){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this.handleMovies(res.results,size);_this.setState({page:page+1});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref4.apply(this,arguments);};}());case 4:_context4.next=8;break;case 6:_context4.prev=6;_context4.t0=_context4[\"catch\"](1);case 8:case\"end\":return _context4.stop();}}},_callee4,null,[[1,6]]);}));_this.handleMovies=function(list,size){var _this$state3=_this.state,movies=_this$state3.movies,pending_movies=_this$state3.pending_movies,page=_this$state3.page;var obj=generateArrays(list,pending_movies,size);_this.setState({movies:[].concat(_toConsumableArray(movies),_toConsumableArray(obj.movies)),pending_movies:obj.pending});};_this.state={movies:[],page:1,size:6,page_limit:5,pending_movies:[],hasMore:true,page_loaded:true,api:'movie/popular'};return _this;}_createClass(MoviesList,[{key:\"componentWillMount\",value:function(){var _componentWillMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:window.scrollTo(0,0);window.addEventListener(\"resize\",this.updateSize);_context5.next=4;return this.updateSize();case 4:this.loadElements();case 5:case\"end\":return _context5.stop();}}},_callee5,this);}));function componentWillMount(){return _componentWillMount.apply(this,arguments);}return componentWillMount;}()},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.removeEventListener(\"resize\",this.updateSize);}},{key:\"render\",value:function render(){var _this2=this;var _this$state4=this.state,selected=_this$state4.selected,selected_movie=_this$state4.selected_movie,show_popup=_this$state4.show_popup,movies=_this$state4.movies,page=_this$state4.page,page_limit=_this$state4.page_limit,size=_this$state4.size;return React.createElement(\"section\",{className:\"movies__list flex__start\"},React.createElement(Navbar,{selectCategory:this.selectCategory}),React.createElement(InfiniteScroll,{dataLength:generateList(movies).length,next:this.loadElements,hasMore:page<page_limit,loader:React.createElement(SmallLoader,null)},movies&&movies.length>0?movies.map(function(list,i){return React.createElement(\"div\",{key:i,id:selected===i?\"selected__row\":\"\",className:\"movies__list__flex flex__column\"},selected===i?React.createElement(\"aside\",{id:\"selected__row__offset\"}):\"\",React.createElement(\"ul\",{className:\"flex__start\"},list.map(function(m){return React.createElement(Movie,{mobile:size===2,key:m.id,isHidden:isHidden,selected:selected===i,handleMovieSelect:function handleMovieSelect(){return _this2.handleMovieSelect(i,m);},selected_movie:selected_movie===m.id,movie:m});})),selected===i&&selected_movie&&show_popup?React.createElement(MoviePopup,{size:size,mobile:size===2,selected_movie:selected_movie,closePreview:_this2.closePreview,updateParent:_this2.updateState}):\"\");}):React.createElement(\"div\",{className:\"movies__first__loading\"},React.createElement(SmallLoader,null))));}}]);return MoviesList;}(Component);export default MoviesList;","map":{"version":3,"sources":["/Users/denis/Desktop/projects/movies-app/client/src/components/movies/MoviesList.jsx"],"names":["React","Component","Movie","wait","generateArrays","getMovieSize","generateList","MoviePopup","apiGetRequest","InfiniteScroll","Navbar","SmallLoader","isHidden","el","offsetParent","MoviesList","updateSize","state","movies","pending_movies","size","width","window","innerWidth","obj","setState","pending","handleMovieSelect","row_id","movie","selected","selected_movie","id","show_popup","scrollToElement","updateState","name","value","then","element","document","querySelector","scrollIntoView","behavior","block","inline","selectCategory","category","api","page","loadElements","closePreview","res","handleMovies","results","list","page_limit","hasMore","page_loaded","scrollTo","addEventListener","removeEventListener","length","map","i","m"],"mappings":"2+CAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,KAAP,KAAkB,SAAlB,CACA,OAASC,IAAT,CAAeC,cAAf,CAA+BC,YAA/B,CAA6CC,YAA7C,KAAiE,2BAAjE,CACA,MAAOC,CAAAA,UAAP,KAAuB,kCAAvB,CACA,OAASC,aAAT,KAA8B,eAA9B,CACA,MAAOC,CAAAA,cAAP,KAA2B,iCAA3B,CACA,MAAOC,CAAAA,MAAP,KAAmB,kBAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,sBAAxB,CACA,QAASC,CAAAA,QAAT,CAAkBC,EAAlB,CAAsB,CACpB,MAAQA,CAAAA,EAAE,CAACC,YAAH,GAAoB,IAA5B,CACD,C,GACKC,CAAAA,U,oEACJ,qBAAc,4CACZ,8EADY,MAyBdC,UAzBc,sEAyBD,oMAC8B,MAAKC,KADnC,CACHC,MADG,aACHA,MADG,CACKC,cADL,aACKA,cADL,CACqBC,IADrB,aACqBA,IADrB,CAELC,KAFK,CAEGC,MAAM,CAACC,UAFV,uBAIOlB,CAAAA,YAAY,CAACa,MAAD,CAASC,cAAT,CAAyBE,KAAzB,CAAgCD,IAAhC,CAJnB,QAILI,GAJK,eAKX,GAAIA,GAAG,CAACN,MAAR,CAAgB,CACd,MAAKO,QAAL,CAAc,CACZP,MAAM,CAAEM,GAAG,CAACN,MADA,CAEZC,cAAc,CAAEK,GAAG,CAACE,OAFR,CAGZN,IAAI,CAAEI,GAAG,CAACJ,IAHE,CAAd,EAKD,CAXU,sDAzBC,SAuCdO,iBAvCc,CAuCM,SAACC,MAAD,CAASC,KAAT,CAAmB,CACrC,MAAKJ,QAAL,CAAc,CACZK,QAAQ,CAAEF,MADE,CAEZG,cAAc,CAAEF,KAAK,CAACG,EAFV,CAGZC,UAAU,CAAE,IAHA,CAAd,EAMA,MAAKC,eAAL,GACD,CA/Ca,OAiDdC,WAjDc,CAiDA,SAACC,IAAD,CAAOC,KAAP,CAAiB,CAC7B,MAAKZ,QAAL,oBACGW,IADH,CACUC,KADV,GAGD,CArDa,OAuDdH,eAvDc,sEAuDI,iJACTd,IADS,CACD,MAAKH,KADJ,CACTG,IADS,CAEhBjB,IAAI,CAACiB,IAAI,GAAK,CAAT,CAAa,GAAb,CAAmB,GAApB,CAAJ,CAA6BkB,IAA7B,CAAkC,UAAM,CACtC,GAAIC,CAAAA,OAAO,CAAGC,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAAd,CACA,GAAIF,OAAJ,CAAa,CACXA,OAAO,CAACG,cAAR,CAAuB,CACrBC,QAAQ,CAAE,MADW,CAErBC,KAAK,CAAE,OAFc,CAGrBC,MAAM,CAAE,SAHa,CAAvB,EAKD,CACF,CATD,EAFgB,wDAvDJ,SAoEdC,cApEc,CAoEG,SAACC,QAAD,CAAc,CAC7B,MAAKtB,QAAL,CAAc,CACZuB,GAAG,CAACD,QAAQ,CAACC,GADD,CAEZC,IAAI,CAAC,CAFO,CAGZ/B,MAAM,CAAC,EAHK,CAIZC,cAAc,CAAC,EAJH,CAKZY,cAAc,CAAC,EALH,CAMZE,UAAU,CAAC,KANC,CAOZH,QAAQ,CAAC,EAPG,CAAd,CAQG,UAAM,CACP,MAAKoB,YAAL,GACD,CAVD,EAWH,CAhFe,OAiFdC,YAjFc,CAiFC,UAAM,CACnB,MAAK1B,QAAL,CAAc,CACZK,QAAQ,CAAE,EADE,CAEZC,cAAc,CAAE,EAFJ,CAGZE,UAAU,CAAE,EAHA,CAAd,EAKD,CAvFa,OAwFdiB,YAxFc,sEAwFC,oLACe,MAAKjC,KADpB,CACLG,IADK,cACLA,IADK,CACC6B,IADD,cACCA,IADD,CACOD,GADP,cACOA,GADP,yCAILxC,CAAAA,aAAa,CAACwC,GAAD,CAAMC,IAAN,CAAb,CAAyBX,IAAzB,2FAA8B,kBAAOc,GAAP,sHAClC,MAAKC,YAAL,CAAkBD,GAAG,CAACE,OAAtB,CAA+BlC,IAA/B,EACA,MAAKK,QAAL,CAAc,CACZwB,IAAI,CAACA,IAAI,CAAG,CADA,CAAd,EAFkC,wDAA9B,gEAJK,+JAxFD,SAsGdI,YAtGc,CAsGC,SAACE,IAAD,CAAOnC,IAAP,CAAgB,kBACY,MAAKH,KADjB,CACrBC,MADqB,cACrBA,MADqB,CACbC,cADa,cACbA,cADa,CACG8B,IADH,cACGA,IADH,CAE7B,GAAMzB,CAAAA,GAAG,CAAGpB,cAAc,CAACmD,IAAD,CAAOpC,cAAP,CAAuBC,IAAvB,CAA1B,CACA,MAAKK,QAAL,CAAc,CACZP,MAAM,8BAAMA,MAAN,qBAAiBM,GAAG,CAACN,MAArB,EADM,CAEZC,cAAc,CAAEK,GAAG,CAACE,OAFR,CAAd,EAKD,CA9Ga,CAEZ,MAAKT,KAAL,CAAa,CACXC,MAAM,CAAE,EADG,CAEX+B,IAAI,CAAE,CAFK,CAGX7B,IAAI,CAAE,CAHK,CAIXoC,UAAU,CAAC,CAJA,CAKXrC,cAAc,CAAE,EALL,CAMXsC,OAAO,CAAE,IANE,CAOXC,WAAW,CAAC,IAPD,CAQXV,GAAG,CAAC,eARO,CAAb,CAFY,aAYb,C,4RAGC1B,MAAM,CAACqC,QAAP,CAAgB,CAAhB,CAAkB,CAAlB,EACArC,MAAM,CAACsC,gBAAP,CAAwB,QAAxB,CAAkC,KAAK5C,UAAvC,E,uBAEM,MAAKA,UAAL,E,QACN,KAAKkC,YAAL,G,gPAGqB,CACrB5B,MAAM,CAACuC,mBAAP,CAA2B,QAA3B,CAAqC,KAAK7C,UAA1C,EACD,C,uCAwFQ,kCASH,KAAKC,KATF,CAELa,QAFK,cAELA,QAFK,CAGLC,cAHK,cAGLA,cAHK,CAILE,UAJK,cAILA,UAJK,CAKLf,MALK,cAKLA,MALK,CAML+B,IANK,cAMLA,IANK,CAOLO,UAPK,cAOLA,UAPK,CAQLpC,IARK,cAQLA,IARK,CAUP,MACE,gCAAS,SAAS,CAAC,0BAAnB,EACC,oBAAC,MAAD,EACA,cAAc,CAAI,KAAK0B,cADvB,EADD,CAIE,oBAAC,cAAD,EACE,UAAU,CAAExC,YAAY,CAACY,MAAD,CAAZ,CAAqB4C,MADnC,CAEE,IAAI,CAAE,KAAKZ,YAFb,CAGE,OAAO,CAAED,IAAI,CAAGO,UAHlB,CAIE,MAAM,CAAE,oBAAC,WAAD,MAJV,EAMGtC,MAAM,EAAIA,MAAM,CAAC4C,MAAP,CAAgB,CAA1B,CACG5C,MAAM,CAAC6C,GAAP,CAAW,SAACR,IAAD,CAAOS,CAAP,CAAa,CACtB,MACE,4BACE,GAAG,CAAEA,CADP,CAEE,EAAE,CAAElC,QAAQ,GAAKkC,CAAb,CAAiB,eAAjB,CAAmC,EAFzC,CAGE,SAAS,CAAC,iCAHZ,EAKGlC,QAAQ,GAAKkC,CAAb,CACC,6BACC,EAAE,CAAC,uBADJ,EADD,CAIC,EATJ,CAWE,0BAAI,SAAS,CAAC,aAAd,EACGT,IAAI,CAACQ,GAAL,CAAS,SAACE,CAAD,CAAO,CACf,MACE,qBAAC,KAAD,EACA,MAAM,CAAI7C,IAAI,GAAK,CADnB,CAEE,GAAG,CAAE6C,CAAC,CAACjC,EAFT,CAGE,QAAQ,CAAIpB,QAHd,CAIE,QAAQ,CAAEkB,QAAQ,GAAKkC,CAJzB,CAKE,iBAAiB,CAAE,mCACjB,CAAA,MAAI,CAACrC,iBAAL,CAAuBqC,CAAvB,CAA0BC,CAA1B,CADiB,EALrB,CAQE,cAAc,CAAElC,cAAc,GAAKkC,CAAC,CAACjC,EARvC,CASE,KAAK,CAAEiC,CATT,EADF,CAaD,CAdA,CADH,CAXF,CA4BGnC,QAAQ,GAAKkC,CAAb,EAAkBjC,cAAlB,EAAoCE,UAApC,CACC,oBAAC,UAAD,EACA,IAAI,CAAIb,IADR,CAEA,MAAM,CAAIA,IAAI,GAAK,CAFnB,CAGE,cAAc,CAAEW,cAHlB,CAIE,YAAY,CAAE,MAAI,CAACoB,YAJrB,CAKE,YAAY,CAAE,MAAI,CAAChB,WALrB,EADD,CASC,EArCJ,CADF,CA0CD,CA3CD,CADH,CA6CG,2BAAK,SAAS,CAAC,wBAAf,EAAwC,oBAAC,WAAD,MAAxC,CAnDN,CAJF,CADF,CA4DD,C,wBAvLsBlC,S,EA0LzB,cAAec,CAAAA,UAAf","sourcesContent":["import React, { Component } from \"react\";\nimport Movie from \"./Movie\";\nimport { wait, generateArrays, getMovieSize, generateList } from \"../../functions/functions\";\nimport MoviePopup from \"./parts/movie-preview/MoviePopup\";\nimport { apiGetRequest } from \"../../api/api\";\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport Navbar from \"../navbar/Navbar\";\nimport SmallLoader from \"../parts/SmallLoader\";\nfunction isHidden(el) {\n  return (el.offsetParent === null)\n}\nclass MoviesList extends Component {\n  constructor() {\n    super();\n    this.state = {\n      movies: [],\n      page: 1,\n      size: 6,\n      page_limit:5,\n      pending_movies: [],\n      hasMore: true,\n      page_loaded:true,\n      api:'movie/popular'\n    };\n  }\n  async componentWillMount() {\n   \n    window.scrollTo(0,0)\n    window.addEventListener(\"resize\", this.updateSize);\n\n    await this.updateSize();\n    this.loadElements()\n \n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.updateSize);\n  }\n  updateSize = async () => {\n    const { movies, pending_movies, size } = this.state;\n    const width = window.innerWidth;\n\n    const obj = await getMovieSize(movies, pending_movies, width, size);\n    if (obj.movies) {\n      this.setState({\n        movies: obj.movies,\n        pending_movies: obj.pending,\n        size: obj.size,\n      });\n    }\n  };\n\n  handleMovieSelect = (row_id, movie) => {\n    this.setState({\n      selected: row_id,\n      selected_movie: movie.id,\n      show_popup: true,\n    });\n \n    this.scrollToElement();\n  };\n\n  updateState = (name, value) => {\n    this.setState({\n      [name]: value,\n    });\n  };\n\n  scrollToElement = async () => {\n    const {size} = this.state\n    wait(size === 2 ? 100 : 400).then(() => {\n      var element = document.querySelector(\"#selected__row__offset\");\n      if (element) {\n        element.scrollIntoView({\n          behavior: \"auto\",\n          block: \"start\",\n          inline: \"nearest\",\n        });\n      }\n    });\n  };\n  selectCategory = (category) => {\n    this.setState({\n      api:category.api,\n      page:1,\n      movies:[],\n      pending_movies:[],\n      selected_movie:'',\n      show_popup:false,\n      selected:''\n    }, () => {\n      this.loadElements()\n    })\n}\n  closePreview = () => {\n    this.setState({\n      selected: \"\",\n      selected_movie: \"\",\n      show_popup: \"\",\n    });\n  };\n  loadElements = async () => {\n    const { size, page, api } = this.state;\n    \n    try {\n      await apiGetRequest(api, page).then(async (res) => {\n        this.handleMovies(res.results, size);\n        this.setState({\n          page:page + 1\n        })\n      });\n    } catch (error) {}\n  };\n\n\n  handleMovies = (list, size) => {\n    const { movies, pending_movies, page } = this.state;\n    const obj = generateArrays(list, pending_movies, size);\n    this.setState({\n      movies: [...movies, ...obj.movies],\n      pending_movies: obj.pending,\n    });\n   \n  };\n\n  render() {\n    const {\n      selected,\n      selected_movie,\n      show_popup,\n      movies,\n      page,\n      page_limit,\n      size\n    } = this.state;\n    return (  \n      <section className=\"movies__list flex__start\">\n       <Navbar \n       selectCategory = {this.selectCategory}\n       />\n        <InfiniteScroll\n          dataLength={generateList(movies).length} \n          next={this.loadElements}\n          hasMore={page < page_limit}\n          loader={<SmallLoader />}\n        >\n          {movies && movies.length > 0\n            ? movies.map((list, i) => {\n                return (\n                  <div\n                    key={i}\n                    id={selected === i ? \"selected__row\" : \"\"}\n                    className=\"movies__list__flex flex__column\"\n                  >\n                    {selected === i ? (\n                      <aside\n                       id=\"selected__row__offset\"></aside>\n                    ) : (\n                      \"\"\n                    )}\n                    <ul className=\"flex__start\">\n                      {list.map((m) => {\n                        return (\n                          <Movie\n                          mobile = {size === 2}\n                            key={m.id}\n                            isHidden = {isHidden}\n                            selected={selected === i}\n                            handleMovieSelect={() =>\n                              this.handleMovieSelect(i, m)\n                            }\n                            selected_movie={selected_movie === m.id}\n                            movie={m}\n                          />\n                        );\n                      })}\n                    </ul>\n                    {selected === i && selected_movie && show_popup ? (\n                      <MoviePopup\n                      size = {size}\n                      mobile = {size === 2}\n                        selected_movie={selected_movie}\n                        closePreview={this.closePreview}\n                        updateParent={this.updateState}\n                      />\n                    ) : (\n                      \"\"\n                    )}\n                  </div>\n                );\n              })\n            : <div className='movies__first__loading'><SmallLoader /></div>}\n        </InfiniteScroll>\n      </section>\n    );\n  }\n}\n\nexport default MoviesList;\n"]},"metadata":{},"sourceType":"module"}